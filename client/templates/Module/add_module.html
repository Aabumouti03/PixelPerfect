{% extends 'users/base.html' %}
{% load static %}

{% block content %}
    <div class="content">
        <h2 class="page-title">Add New Module</h2>
        <link rel="stylesheet" href="{% static 'client/css/add_module.css' %}">

        <form method="POST">
            {% csrf_token %}
            {{ form.as_p }}

            <!-- Add Section Button -->
            <a href="{% url 'add_section' %}" class="btn btn-secondary">+ Add New Section</a>
            
            <button type="submit" class="save-btn">Save Module</button>
        </form>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        function updateSectionsDropdown() {
            fetch("{% url 'get_sections' %}")  // Fetch updated section list
            .then(response => response.json())
            .then(data => {
                let sectionDropdown = document.querySelector('select[name="sections"]');
                sectionDropdown.innerHTML = "";  // Clear old options
                
                data.sections.forEach(section => {
                    let option = document.createElement("option");
                    option.value = section.id;
                    option.textContent = section.title;
                    sectionDropdown.appendChild(option);
                });
            });
        }

        updateSectionsDropdown();  // Call the function when the page loads
    });
    </script>
{% endblock %}
